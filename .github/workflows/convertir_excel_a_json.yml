name: Convertir Excel a JSON

on:
  push:
    paths:
      - 'data/*.xlsx'
  workflow_dispatch:

jobs:
  convertir:
    runs-on: ubuntu-latest

    steps:
      - name: Descargar el repositorio
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Instalar dependencias
        run: pip install pandas openpyxl

      - name: Convertir Excel a JSON
        run: |
          python - <<'EOF'
import os
import pandas as pd

archivos = [
    "clientes_cable.xlsx",
    "clientes_internet.xlsx",
    "clientes_gpon_borrados.xlsx",
    "probable_gpon.xlsx"
]

os.makedirs("data", exist_ok=True)

for archivo in archivos:
    path_excel = f"data/{archivo}"
    if os.path.exists(path_excel):
        df = pd.read_excel(path_excel)
        nombre_json = archivo.replace(".xlsx", ".json")
        df.to_json(f"data/{nombre_json}", orient="records", force_ascii=False, indent=2)
        print(f"✅ Convertido: {archivo} → {nombre_json}")
    else:
        print(f"⚠️ No se encontró: {archivo}")
EOF

      - name: Subir los JSON generados automáticamente
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Actualización automática de archivos JSON"
          file_pattern: data/*.json
