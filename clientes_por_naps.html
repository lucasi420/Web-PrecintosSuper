<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clientes por NAPs - SUPER USHUAIA</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="max-w-5xl mx-auto py-6">
    <h1 class="text-2xl font-bold text-center mb-6 text-blue-700">CLIENTES POR NAPs</h1>

    <div class="flex flex-col md:flex-row justify-center gap-4 mb-6">
      <select id="nodoSelect" class="border rounded-lg p-2 w-full md:w-1/3">
        <option value="">Seleccione un Nodo</option>
      </select>

      <select id="napSelect" class="border rounded-lg p-2 w-full md:w-1/3">
        <option value="">Seleccione una NAP</option>
      </select>
    </div>

    <div id="resultado" class="bg-white rounded-lg shadow p-4 hidden">
      <h2 class="text-lg font-semibold mb-3 text-gray-800">Clientes encontrados:</h2>
      <table class="min-w-full border">
        <thead class="bg-blue-600 text-white">
          <tr>
            <th class="px-4 py-2 border"># Cliente</th>
            <th class="px-4 py-2 border">Nombre</th>
            <th class="px-4 py-2 border">Dirección</th>
            <th class="px-4 py-2 border">Puerto</th>
          </tr>
        </thead>
        <tbody id="tablaClientes"></tbody>
      </table>
    </div>

    <p id="actualizado" class="text-center text-sm text-gray-500 mt-6"></p>
  </div>

  <script>
    async function cargarDatos() {
      try {
        const resp = await fetch("data/clientes_internet.json");
        const data = await resp.json();
        const clientes = data.clientes;
        const actualizado = data.actualizado;

        document.getElementById("actualizado").textContent = "Última actualización: " + actualizado;

        // Obtener nodos y naps únicos
        const nodos = [...new Set(clientes.map(c => c.nodo).filter(Boolean))].sort();
        const naps = [...new Set(clientes.map(c => c.nap).filter(Boolean))].sort();

        const nodoSelect = document.getElementById("nodoSelect");
        const napSelect = document.getElementById("napSelect");

        nodos.forEach(nodo => {
          const opt = document.createElement("option");
          opt.value = nodo;
          opt.textContent = nodo;
          nodoSelect.appendChild(opt);
        });

        naps.forEach(nap => {
          const opt = document.createElement("option");
          opt.value = nap;
          opt.textContent = nap;
          napSelect.appendChild(opt);
        });

        function filtrarClientes() {
          const nodo = nodoSelect.value;
          const nap = napSelect.value;
          const resultadoDiv = document.getElementById("resultado");
          const tbody = document.getElementById("tablaClientes");

          if (!nodo || !nap) {
            resultadoDiv.classList.add("hidden");
            return;
          }

          const filtrados = clientes
            .filter(c => c.nodo === nodo && c.nap === nap)
            .sort((a, b) => a.puerto - b.puerto);

          if (filtrados.length === 0) {
            resultadoDiv.classList.remove("hidden");
            tbody.innerHTML = `<tr><td colspan="4" class="text-center p-3 text-gray-600">No se encontraron clientes para esta combinación.</td></tr>`;
            return;
          }

          tbody.innerHTML = filtrados.map(c => `
            <tr class="hover:bg-gray-50">
              <td class="border px-4 py-2">${c.numero_cliente}</td>
              <td class="border px-4 py-2">${c.nombre}</td>
              <td class="border px-4 py-2">${c.domicilio}</td>
              <td class="border px-4 py-2 text-center">${c.puerto}</td>
            </tr>
          `).join("");

          resultadoDiv.classList.remove("hidden");
        }

        nodoSelect.addEventListener("change", filtrarClientes);
        napSelect.addEventListener("change", filtrarClientes);

      } catch (err) {
        console.error("Error cargando JSON:", err);
      }
    }

    cargarDatos();
  </script>
</body>
</html>
